<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>KIMYOGAR - Reaksiya Simulyatori</title>
    <style>
        body {
            margin: 0;
            background-color: #1a1a2e;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* CHAP TOMON - OMBOR (ELEMENTLAR) */
        #inventory {
            width: 250px;
            background-color: #16213e;
            border-right: 2px solid #0f3460;
            padding: 20px;
            overflow-y: auto;
        }
        .section-title {
            color: #00d2ff;
            border-bottom: 2px solid #00d2ff;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .item {
            background: #0f3460;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.2s;
            border: 1px solid transparent;
        }
        .item:hover {
            background: #1a2a50;
            border-color: #00d2ff;
            transform: translateX(5px);
        }
        .formula { font-weight: bold; color: #e94560; font-family: monospace; font-size: 16px; }

        /* O'RTA - LABORATORIYA STOLI */
        #lab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, #252a40 0%, #1a1a2e 100%);
        }

        /* MIJOZ EKRANI */
        #client-screen {
            background: #0f3460;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e94560;
            text-align: center;
            width: 60%;
            margin-bottom: 40px;
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.2);
        }
        #order-text { font-size: 20px; margin-bottom: 10px; }
        #target-substance { font-size: 30px; color: #e94560; font-weight: bold; }
        #money-display { 
            position: absolute; top: 20px; right: 20px; 
            font-size: 24px; color: #00ff00; font-weight: bold; 
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 10px;
        }

        /* KOLBA (ARALASHMA JOYI) */
        #flask {
            width: 200px;
            height: 200px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }
        #flask::before { content: "KOLBA"; position: absolute; top: -30px; color: #aaa; font-size: 12px; }

        .flask-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 4px;
            margin: 2px;
            font-size: 12px;
        }

        /* TUGMALAR */
        .btn-group { display: flex; gap: 10px; }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        #mix-btn { background: #00d2ff; color: #000; }
        #mix-btn:hover { background: #00aaff; box-shadow: 0 0 15px #00d2ff; }
        
        #clear-btn { background: #e94560; color: white; }
        #clear-btn:hover { background: #c0354a; }

        /* JAVOB XABARI */
        #message {
            height: 30px;
            margin-top: 15px;
            font-weight: bold;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <div id="inventory">
        <div class="section-title">ELEMENTLAR & MODDALAR</div>
        <div id="items-list">
            </div>
    </div>

    <div id="lab">
        <div id="money-display">üí∞ $0</div>

        <div id="client-screen">
            <div id="order-text">üëã Salom! Menga quyidagi modda kerak:</div>
            <div id="target-substance">...</div>
            <div style="margin-top:10px; font-size: 14px; color:#aaa;">(Narxi: $<span id="order-price">0</span>)</div>
        </div>

        <div id="flask" title="Moddalarni shu yerga bosing">
            </div>

        <div class="btn-group">
            <button id="clear-btn" onclick="clearFlask()">TOZALASH üóëÔ∏è</button>
            <button id="mix-btn" onclick="react()">REAKSIYA ‚öóÔ∏è</button>
        </div>

        <div id="message"></div>
    </div>

    <script>
        // ---------------------------------------------------------
        // 1. MA'LUMOTLAR BAZASI (KIMYOVIY RETSEPTLAR)
        // ---------------------------------------------------------
        
        // O'yindagi bor barcha moddalar
        const substances = [
            { id: 'H2', name: 'Vodorod', type: 'gas' },
            { id: 'O2', name: 'Kislorod', type: 'gas' },
            { id: 'C', name: 'Uglerod', type: 'solid' },
            { id: 'Na', name: 'Natriy', type: 'solid' },
            { id: 'Cl2', name: 'Xlor', type: 'gas' },
            { id: 'H2O', name: 'Suv', type: 'liquid' },
            { id: 'Al4C3', name: 'Alyuminiy Karbid', type: 'solid' },
            { id: 'HCl', name: 'Xlorid Kislota', type: 'liquid' },
            { id: 'NaOH', name: 'Natriy Gidroksid', type: 'solid' },
            // Natijaviy moddalar (Omborda bo'lmasligi ham mumkin)
            { id: 'CH4', name: 'Metan', type: 'gas' },
            { id: 'NaCl', name: 'Osh tuzi', type: 'solid' },
            { id: 'CO2', name: 'Karbonat Angidrid', type: 'gas' },
            { id: 'Al(OH)3', name: 'Alyuminiy Gidroksid', type: 'solid' }
        ];

        // Reaksiya qoidalari (Inputs -> Outputs)
        // Tartib muhim emas, kod o'zi saralaydi
        const recipes = [
            { inputs: ['H2', 'O2'], output: 'H2O', price: 50 },
            { inputs: ['Na', 'Cl2'], output: 'NaCl', price: 70 },
            { inputs: ['C', 'O2'], output: 'CO2', price: 40 },
            { inputs: ['Al4C3', 'H2O'], output: 'CH4', extra: 'Al(OH)3', price: 200 }, // Siz so'ragan reaksiya
            { inputs: ['HCl', 'NaOH'], output: 'NaCl', extra: 'H2O', price: 100 },
        ];

        // ---------------------------------------------------------
        // 2. O'YIN MANTIG'I
        // ---------------------------------------------------------
        
        let currentMoney = 0;
        let flaskContents = []; // Kolbadagi narsalar
        let currentOrder = null;

        // O'yin boshlanishi
        window.onload = function() {
            renderInventory();
            generateNewOrder();
        };

        // Omborni chizish
        function renderInventory() {
            const list = document.getElementById('items-list');
            list.innerHTML = "";
            
            // Faqat "Result" bo'lmagan, ya'ni boshlang'ich moddalarni chiqaramiz
            // Yoki hammasini chiqaramiz, o'yin qiyinligiga qarab.
            // Hozircha asosiy reaktiflarni chiqaramiz.
            const starterPack = ['H2', 'O2', 'C', 'Na', 'Cl2', 'H2O', 'Al4C3', 'HCl', 'NaOH'];

            substances.forEach(sub => {
                if(starterPack.includes(sub.id)) {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `<span>${sub.name}</span> <span class="formula">${sub.id}</span>`;
                    div.onclick = () => addToFlask(sub);
                    list.appendChild(div);
                }
            });
        }

        // Kolbaga modda qo'shish
        function addToFlask(sub) {
            if (flaskContents.length >= 2) {
                showMessage("Kolba to'la! Avval reaksiyani boshlang yoki tozalang.", "red");
                return;
            }
            flaskContents.push(sub.id);
            updateFlaskUI();
        }

        // Kolbani tozalash
        function clearFlask() {
            flaskContents = [];
            updateFlaskUI();
            showMessage("", "white");
        }

        // Kolba ko'rinishini yangilash
        function updateFlaskUI() {
            const flaskDiv = document.getElementById('flask');
            flaskDiv.innerHTML = "";
            flaskContents.forEach(item => {
                const sub = substances.find(s => s.id === item);
                const span = document.createElement('span');
                span.className = 'flask-item';
                span.innerText = sub.formula || sub.id; // Formula
                flaskDiv.appendChild(span);
            });
        }

        // REAKSIYA BOSHLASH (ASOSIY MANTIQ)
        function react() {
            if (flaskContents.length < 2) {
                showMessage("Reaksiya uchun kamida 2 ta modda kerak!", "orange");
                return;
            }

            // 1. Kolbadagi moddalarni tartiblaymiz (Inputlar ketma-ketligi muhim bo'lmasligi uchun)
            flaskContents.sort();

            // 2. Retseptlarni tekshiramiz
            let foundRecipe = null;

            for (let recipe of recipes) {
                // Retsept inputlarini ham tartiblaymiz
                const recipeInputs = [...recipe.inputs].sort();
                
                // Solishtiramiz
                if (JSON.stringify(flaskContents) === JSON.stringify(recipeInputs)) {
                    foundRecipe = recipe;
                    break;
                }
            }

            // 3. Natija
            if (foundRecipe) {
                // Reaksiya muvaffaqiyatli!
                const outputName = getSubName(foundRecipe.output);
                
                // Mijoz so'ragan narsami?
                if (foundRecipe.output === currentOrder.output) {
                    successReaction(foundRecipe);
                } else {
                    // Reaksiya o'xshadi, lekin mijoz buni so'ramagan
                    showMessage(`Reaksiya ketdi! ${outputName} hosil bo'ldi, lekin mijozga ${currentOrder.output} kerak edi.`, "yellow");
                    clearFlask();
                }
            } else {
                // Reaksiya yo'q
                showMessage("Bu moddalar reaksiyaga kirishmadi yoki portlab ketdi! üí•", "red");
                clearFlask();
            }
        }

        // Muvaffaqiyatli savdo
        function successReaction(recipe) {
            const outputName = getSubName(recipe.output);
            
            // Effekt
            document.getElementById('flask').style.backgroundColor = "#00ff00";
            setTimeout(() => document.getElementById('flask').style.backgroundColor = "rgba(255,255,255,0.05)", 500);

            showMessage(`AJOYIB! Siz ${outputName} oldingiz! +$${recipe.price}`, "#00ff00");
            
            currentMoney += recipe.price;
            document.getElementById('money-display').innerText = `üí∞ $${currentMoney}`;
            
            clearFlask();
            
            // Yangi buyurtma
            setTimeout(() => {
                generateNewOrder();
            }, 2000);
        }

        // Yangi buyurtma generatsiya qilish
        function generateNewOrder() {
            // Tasodifiy retsept tanlash
            const randomRecipe = recipes[Math.floor(Math.random() * recipes.length)];
            currentOrder = randomRecipe;
            
            const subName = getSubName(randomRecipe.output);
            
            document.getElementById('target-substance').innerText = `${subName} (${randomRecipe.output})`;
            document.getElementById('order-price').innerText = randomRecipe.price;
            showMessage("Yangi mijoz keldi...", "cyan");
        }

        // Yordamchi funksiya: ID dan nomni olish
        function getSubName(id) {
            const s = substances.find(x => x.id === id);
            return s ? s.name : id;
        }

        function showMessage(text, color) {
            const m = document.getElementById('message');
            m.innerText = text;
            m.style.color = color;
        }

    </script>
</body>
</html>
