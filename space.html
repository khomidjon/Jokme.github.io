<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>JARVIS - ETERNAL SUN</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* NISHON (KRESTIK) */
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px;
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 10;
        }
        #crosshair::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 4px; height: 4px; background: red;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        /* MA'LUMOT EKRANI */
        #data-panel {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0, 20, 0, 0.8);
            border: 1px solid #00ff00;
            padding: 15px;
            color: #00ff00;
            font-size: 16px;
            border-radius: 8px;
            min-width: 200px;
            display: none;
            box-shadow: 0 0 15px #00ff00;
        }
        #target-name { font-size: 24px; font-weight: bold; border-bottom: 1px solid #00ff00; margin-bottom: 5px; }
        
        /* MENU */
        #menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 100;
        }
        .key { color: black; background: #00ff00; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="crosshair"></div>

    <div id="menu">
        <h1 style="color: #00ff00; text-shadow: 0 0 20px #00ff00;">JARVIS SYSTEM</h1>
        <p>BOSHLASH UCHUN EKRANGA BOSING</p>
        <br>
        <p><span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span> - Uchish</p>
        <p><span class="key">SHIFT</span> - Tezlashish</p>
        <p><span class="key">O'NG TUGMA</span> - Masofani o'lchash (Lazer)</p>
    </div>

    <div id="data-panel">
        <div id="target-name">NOMA'LUM</div>
        <div id="target-dist">Masofa: ---</div>
        <div id="scan-status">SKANERLASH...</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        let camera, scene, renderer, controls, raycaster;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, moveUp = false, moveDown = false;
        let speedMultiplier = 1;
        
        const planets = []; 

        init();
        animate();

        function init() {
            // 1. SAHNA
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            scene.fog = new THREE.FogExp2(0x000000, 0.0002);

            // 2. KAMERA
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000000);
            camera.position.set(0, 0, 400); // Quyoshdan uzoqroqda

            // 3. RENDERER
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            // Yoritishni kuchaytirish
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            document.body.appendChild(renderer.domElement);

            // 4. RAYCASTER
            raycaster = new THREE.Raycaster();

            // 5. BOSHQARUV
            controls = new PointerLockControls(camera, document.body);
            const menu = document.getElementById('menu');
            
            menu.addEventListener('click', () => controls.lock());
            controls.addEventListener('lock', () => menu.style.display = 'none');
            controls.addEventListener('unlock', () => menu.style.display = 'flex');

            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            window.addEventListener('contextmenu', onRightClick);

            // 6. YORUG'LIK (MUHIM)
            const ambientLight = new THREE.AmbientLight(0x222222); 
            scene.add(ambientLight);

            // 7. OBEKTLARNI YARATISH (Internet shart emas)
            createGeneratedStars();
            createProceduralSun();
            createSolarSystem();

            window.addEventListener('resize', onWindowResize);
        }

        // --- 1. SUPER OLOVLI QUYOSH (RASMSIZ) ---
        function createProceduralSun() {
            // A) Quyosh Markazi (Oppoq/Sariq yadro)
            const geometry = new THREE.SphereGeometry(60, 64, 64);
            const material = new THREE.MeshBasicMaterial({ color: 0xffffff }); // Markazi oppoq (juda issiq)
            const sun = new THREE.Mesh(geometry, material);
            sun.name = "QUYOSH";
            
            // B) Quyosh Atmosferasi (Shader trick) - Sariq/Qizil qobiq
            // Biz rasm o'rniga shaffof qobiq ishlatamiz
            const atmosGeo = new THREE.SphereGeometry(62, 64, 64);
            const atmosMat = new THREE.MeshBasicMaterial({
                color: 0xffaa00, // Olovrang
                transparent: true,
                opacity: 0.5,
                side: THREE.BackSide // Ichki tomoni ko'rinmaydi
            });
            const atmosphere = new THREE.Mesh(atmosGeo, atmosMat);
            sun.add(atmosphere);

            // C) NUR (Glow) - Buni Canvasda chizamiz (Rasm kerak emas)
            const glowTexture = createGlowTexture();
            const spriteMaterial = new THREE.SpriteMaterial({ 
                map: glowTexture, 
                color: 0xff4400, // Qizg'ish olov
                transparent: true, 
                blending: THREE.AdditiveBlending, // Yoritish rejimi
                opacity: 1.0
            });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(400, 400, 1.0); // Katta nur
            sun.add(sprite);

            // D) Oq Nur (Yadro nuri)
            const coreMaterial = new THREE.SpriteMaterial({ 
                map: glowTexture, 
                color: 0xffffee, 
                transparent: true, 
                blending: THREE.AdditiveBlending,
                opacity: 0.8
            });
            const coreSprite = new THREE.Sprite(coreMaterial);
            coreSprite.scale.set(150, 150, 1.0);
            sun.add(coreSprite);

            // E) Haqiqiy Yorug'lik manbasi
            const sunLight = new THREE.PointLight(0xffffff, 3, 0);
            sun.add(sunLight);

            scene.add(sun);
            planets.push(sun);
        }

        // --- NUR TEXTURASINI YARATISH (CANVAS) ---
        function createGlowTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 64; canvas.height = 64;
            const context = canvas.getContext('2d');
            const gradient = context.createRadialGradient(32, 32, 0, 32, 32, 32);
            gradient.addColorStop(0, 'rgba(255,255,255,1)'); // Markaz
            gradient.addColorStop(0.2, 'rgba(255,255,255,0.8)');
            gradient.addColorStop(0.5, 'rgba(255,200,0,0.2)');
            gradient.addColorStop(1, 'rgba(0,0,0,0)'); // Chetlar
            context.fillStyle = gradient;
            context.fillRect(0,0,64,64);
            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // --- 2. SAYYORALAR (RANGLI) ---
        function createSolarSystem() {
            const data = [
                { name: "MERKURIY", size: 5, dist: 120, color: 0xaaaaaa },
                { name: "VENERA", size: 8, dist: 180, color: 0xffcc00 },
                { name: "YER", size: 9, dist: 250, color: 0x0055ff },
                { name: "MARS", size: 6, dist: 350, color: 0xff3300 },
                { name: "YUPITER", size: 25, dist: 500, color: 0xffaa88 },
                { name: "SATURN", size: 20, dist: 700, color: 0xffddaa, ring: true },
                { name: "URAN", size: 12, dist: 900, color: 0x00ffff },
                { name: "NEPTUN", size: 12, dist: 1100, color: 0x0000ff }
            ];

            data.forEach(p => {
                const geo = new THREE.SphereGeometry(p.size, 64, 64);
                // Standard Material yorug'likni yaxshi qaytaradi
                const mat = new THREE.MeshStandardMaterial({
                    color: p.color,
                    roughness: 0.5,
                    metalness: 0.1
                });

                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set(p.dist, 0, 0);
                mesh.name = p.name;
                
                // Halqasi bormi?
                if(p.ring) {
                    const ringGeo = new THREE.RingGeometry(p.size + 5, p.size + 15, 64);
                    const ringMat = new THREE.MeshBasicMaterial({ color: 0xccaacc, side: THREE.DoubleSide, transparent: true, opacity: 0.6 });
                    const ring = new THREE.Mesh(ringGeo, ringMat);
                    ring.rotation.x = Math.PI / 2;
                    mesh.add(ring);
                }

                scene.add(mesh);
                planets.push(mesh);
            });
        }

        // --- 3. YULDUZLAR (KOD BILAN) ---
        function createGeneratedStars() {
            const starGeo = new THREE.BufferGeometry();
            const positions = new Float32Array(30000); 
            for(let i=0; i<30000; i++) {
                positions[i] = (Math.random() - 0.5) * 50000;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 0.9});
            const stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);
        }

        // --- MASOFA O'LCHASH (O'NG TUGMA) ---
        function onRightClick(event) {
            if(!controls.isLocked) return;

            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            const intersects = raycaster.intersectObjects(planets);

            const panel = document.getElementById('data-panel');
            const nameDiv = document.getElementById('target-name');
            const distDiv = document.getElementById('target-dist');
            const statusDiv = document.getElementById('scan-status');

            panel.style.display = 'block';

            if (intersects.length > 0) {
                const hit = intersects[0];
                const distanceToSurface = hit.distance;

                nameDiv.innerText = hit.object.name;
                nameDiv.style.color = "#00ff00";
                statusDiv.innerText = "HISOBLANMOQDA...";
                statusDiv.style.color = "yellow";
                
                setTimeout(() => {
                    distDiv.innerText = `Masofa: ${Math.floor(distanceToSurface * 1000)} km`;
                    statusDiv.innerText = "LOKATSIYA TASDIQLANDI";
                    statusDiv.style.color = "cyan";
                }, 500);
            } else {
                nameDiv.innerText = "KOINOT BO'SHLIG'I";
                nameDiv.style.color = "red";
                distDiv.innerText = "Ob'ekt topilmadi";
                statusDiv.innerText = "QAYTA URINING";
                statusDiv.style.color = "orange";
            }
        }

        function onKeyDown(event) {
            switch (event.code) {
                case 'KeyW': moveForward = true; break;
                case 'KeyA': moveLeft = true; break;
                case 'KeyS': moveBackward = true; break;
                case 'KeyD': moveRight = true; break;
                case 'Space': moveUp = true; break;
                case 'ControlLeft': moveDown = true; break;
                case 'ShiftLeft': speedMultiplier = 10; break;
            }
        }

        function onKeyUp(event) {
            switch (event.code) {
                case 'KeyW': moveForward = false; break;
                case 'KeyA': moveLeft = false; break;
                case 'KeyS': moveBackward = false; break;
                case 'KeyD': moveRight = false; break;
                case 'Space': moveUp = false; break;
                case 'ControlLeft': moveDown = false; break;
                case 'ShiftLeft': speedMultiplier = 1; break;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            // Uchish
            if (controls.isLocked) {
                const delta = 1.0 * speedMultiplier;
                if (moveForward) controls.moveForward(delta);
                if (moveBackward) controls.moveForward(-delta);
                if (moveRight) controls.moveRight(delta);
                if (moveLeft) controls.moveRight(-delta);
                if (moveUp) camera.position.y += delta;
                if (moveDown) camera.position.y -= delta;
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
