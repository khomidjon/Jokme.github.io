<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>JARVIS - REAL SPACE</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* NISHON (KRESTIK) */
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px;
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 10;
        }
        #crosshair::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 4px; height: 4px; background: red;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        /* MA'LUMOT EKRANI */
        #data-panel {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0, 20, 0, 0.7);
            border: 1px solid #00ff00;
            padding: 15px;
            color: #00ff00;
            font-size: 16px;
            border-radius: 8px;
            min-width: 200px;
            display: none; /* Boshida yashirin */
        }
        #target-name { font-size: 24px; font-weight: bold; border-bottom: 1px solid #00ff00; margin-bottom: 5px; }
        
        /* MENU */
        #menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 100;
        }
        .key { color: black; background: #00ff00; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="crosshair"></div>

    <div id="menu">
        <h1 style="color: #00ff00; text-shadow: 0 0 20px #00ff00;">JARVIS SYSTEM</h1>
        <p>BOSHLASH UCHUN EKRANGA BOSING</p>
        <br>
        <p><span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span> - Uchish</p>
        <p><span class="key">SHIFT</span> - Tezlashish</p>
        <p><span class="key">O'NG TUGMA</span> - Masofani o'lchash (Lazer)</p>
    </div>

    <div id="data-panel">
        <div id="target-name">NOMA'LUM</div>
        <div id="target-dist">Masofa: ---</div>
        <div id="scan-status">SKANERLASH...</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        let camera, scene, renderer, controls, raycaster;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, moveUp = false, moveDown = false;
        let speedMultiplier = 1;
        
        const textureLoader = new THREE.TextureLoader();
        const planets = []; // Raycaster uchun ro'yxat

        init();
        animate();

        function init() {
            // 1. SAHNA
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            scene.fog = new THREE.FogExp2(0x000000, 0.0001);

            // 2. KAMERA
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000000);
            camera.position.set(0, 0, 300);

            // 3. RENDERER
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // 4. RAYCASTER (Lazer o'lchagich)
            raycaster = new THREE.Raycaster();

            // 5. BOSHQARUV
            controls = new PointerLockControls(camera, document.body);
            const menu = document.getElementById('menu');
            
            menu.addEventListener('click', () => controls.lock());
            controls.addEventListener('lock', () => menu.style.display = 'none');
            controls.addEventListener('unlock', () => menu.style.display = 'flex');

            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            
            // MOUSE RIGHT CLICK (Masofa o'lchash)
            window.addEventListener('contextmenu', onRightClick);

            // 6. YORUG'LIK
            const ambientLight = new THREE.AmbientLight(0x333333); // Umumiy yorug'lik
            scene.add(ambientLight);

            // 7. OBEKTLAR
            createStars();
            createRealisticSun();
            createSolarSystem();

            window.addEventListener('resize', onWindowResize);
        }

        // --- SUPER REAL QUYOSH ---
        function createRealisticSun() {
            // A) Quyosh tanasi (Oppoq-Sariq) - O'zi nur sochadi (BasicMaterial)
            const geometry = new THREE.SphereGeometry(60, 64, 64);
            const material = new THREE.MeshBasicMaterial({ color: 0xffddaa }); 
            const sun = new THREE.Mesh(geometry, material);
            sun.name = "QUYOSH";
            
            // B) Nur (PointLight) - Butun sistemani yoritadi
            const sunLight = new THREE.PointLight(0xffffff, 3, 0); // Cheksiz masofa
            sun.add(sunLight);

            // C) GLOW (Nur yog'dusi) - Sprite ishlatamiz
            const spriteMaterial = new THREE.SpriteMaterial({ 
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/sprites/glow.png'), 
                color: 0xffaa00, 
                transparent: true, 
                blending: THREE.AdditiveBlending, // Ranglarni qo'shish (yorqinlik uchun)
                depthWrite: false // Boshqa narsalarni to'sib qo'ymaydi
            });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(300, 300, 1.0); // Quyoshdan 5 barobar katta nur
            sun.add(sprite);

            // Ikkinchi qavat nur (Oppoq markaz uchun)
            const coreMaterial = new THREE.SpriteMaterial({ 
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/sprites/glow.png'), 
                color: 0xffffff, 
                transparent: true, 
                blending: THREE.AdditiveBlending,
            });
            const coreSprite = new THREE.Sprite(coreMaterial);
            coreSprite.scale.set(150, 150, 1.0);
            sun.add(coreSprite);

            scene.add(sun);
            planets.push(sun); // Lazer uchun ro'yxatga qo'shamiz
        }

        function createSolarSystem() {
            // Sayyoralar ma'lumotlari (Hajmi kattalashtirildi ko'rinishi uchun)
            const data = [
                { name: "MERKURIY", size: 5, dist: 100, color: 0xaaaaaa, tex: 'moon_1024.jpg' },
                { name: "VENERA", size: 8, dist: 150, color: 0xe6b800, tex: 'venus_atmosphere_2k.jpg' },
                { name: "YER", size: 9, dist: 220, color: 0x2233ff, tex: 'earth_atmos_2048.jpg', isEarth: true },
                { name: "MARS", size: 6, dist: 300, color: 0xff3300, tex: 'mars_1k.jpg' },
                { name: "YUPITER", size: 25, dist: 450, color: 0xd9b38c, tex: 'jupiter_2k.jpg' },
                { name: "SATURN", size: 20, dist: 650, color: 0xf4d19f, tex: 'saturn_2k.jpg', ring: true },
                { name: "URAN", size: 12, dist: 850, color: 0x66ccff, tex: 'uranus_2k.jpg' },
                { name: "NEPTUN", size: 12, dist: 1000, color: 0x3333ff, tex: 'neptune_2k.jpg' }
            ];

            data.forEach(p => {
                const geo = new THREE.SphereGeometry(p.size, 64, 64);
                let mat;
                
                // Tekstura yuklash
                const texUrl = `https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/${p.tex}`;
                
                if(p.isEarth) {
                    mat = new THREE.MeshPhongMaterial({
                        map: textureLoader.load(texUrl),
                        specular: new THREE.Color(0x333333),
                        shininess: 5
                    });
                } else {
                    mat = new THREE.MeshStandardMaterial({
                        map: textureLoader.load(texUrl),
                        color: 0xffffff,
                        roughness: 0.8
                    });
                }

                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set(p.dist, 0, 0); // Bir qatorga tizib chiqamiz boshida
                mesh.name = p.name;
                mesh.userData = { angle: Math.random() * 10, dist: p.dist, speed: 100 / p.dist }; // Aylanish uchun

                // Saturn halqasi
                if(p.ring) {
                    const ringGeo = new THREE.RingGeometry(p.size + 5, p.size + 15, 64);
                    const ringMat = new THREE.MeshBasicMaterial({ color: 0xcfb593, side: THREE.DoubleSide, transparent: true, opacity: 0.6 });
                    const ring = new THREE.Mesh(ringGeo, ringMat);
                    ring.rotation.x = Math.PI / 2;
                    mesh.add(ring);
                }

                scene.add(mesh);
                planets.push(mesh);
            });
        }

        function createStars() {
            const starGeo = new THREE.BufferGeometry();
            const positions = new Float32Array(30000); // 10,000 yulduz
            for(let i=0; i<30000; i++) {
                positions[i] = (Math.random() - 0.5) * 10000;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 0.8});
            const stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);
        }

        // --- MASOFA O'LCHASH (O'NG TUGMA) ---
        function onRightClick(event) {
            if(!controls.isLocked) return; // Menyudagida ishlamasin

            // Markazdan nur otish (0, 0)
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);

            // Nur nimalarga tegdi?
            const intersects = raycaster.intersectObjects(planets);

            const panel = document.getElementById('data-panel');
            const nameDiv = document.getElementById('target-name');
            const distDiv = document.getElementById('target-dist');
            const statusDiv = document.getElementById('scan-status');

            panel.style.display = 'block';

            if (intersects.length > 0) {
                // Nur nimagadir tegdi
                const hit = intersects[0];
                const object = hit.object;
                const distanceToSurface = hit.distance; // Raycaster sirtgacha bo'lgan masofani beradi!

                nameDiv.innerText = object.name;
                nameDiv.style.color = "#00ff00";
                
                // Animatsiya bilan hisoblash
                statusDiv.innerText = "HISOBLANMOQDA...";
                setTimeout(() => {
                    distDiv.innerText = `Masofa: ${Math.floor(distanceToSurface * 1000)} km`;
                    statusDiv.innerText = "LOKATSIYA TASDIQLANDI";
                    statusDiv.style.color = "cyan";
                }, 500);

            } else {
                // Bo'shliqqa tegdi
                nameDiv.innerText = "KOINOT BO'SHLIG'I";
                nameDiv.style.color = "red";
                distDiv.innerText = "Ob'ekt topilmadi";
                statusDiv.innerText = "QAYTA URINING";
                statusDiv.style.color = "orange";
            }
        }

        function onKeyDown(event) {
            switch (event.code) {
                case 'KeyW': moveForward = true; break;
                case 'KeyA': moveLeft = true; break;
                case 'KeyS': moveBackward = true; break;
                case 'KeyD': moveRight = true; break;
                case 'Space': moveUp = true; break;
                case 'ControlLeft': moveDown = true; break;
                case 'ShiftLeft': speedMultiplier = 10; break;
            }
        }

        function onKeyUp(event) {
            switch (event.code) {
                case 'KeyW': moveForward = false; break;
                case 'KeyA': moveLeft = false; break;
                case 'KeyS': moveBackward = false; break;
                case 'KeyD': moveRight = false; break;
                case 'Space': moveUp = false; break;
                case 'ControlLeft': moveDown = false; break;
                case 'ShiftLeft': speedMultiplier = 1; break;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            // Sayyoralarni aylantirish
            const time = Date.now() * 0.0001;
            planets.forEach(p => {
                if (p.name !== "QUYOSH") {
                    p.position.x = Math.cos(time * p.userData.speed + p.userData.angle) * p.userData.dist;
                    p.position.z = Math.sin(time * p.userData.speed + p.userData.angle) * p.userData.dist;
                    p.rotation.y += 0.005;
                }
            });

            // Uchish
            if (controls.isLocked) {
                const delta = 1.0 * speedMultiplier;
                if (moveForward) controls.moveForward(delta);
                if (moveBackward) controls.moveForward(-delta);
                if (moveRight) controls.moveRight(delta);
                if (moveLeft) controls.moveRight(-delta);
                if (moveUp) camera.position.y += delta;
                if (moveDown) camera.position.y -= delta;
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
