<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>JARVIS - Real Kosmos</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', sans-serif; }
        
        #instructions {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.7); color: white; cursor: pointer; z-index: 100;
        }
        h1 { font-size: 40px; text-shadow: 0 0 20px cyan; margin: 0; }
        p { font-size: 18px; color: #ccc; }
        .key { color: cyan; font-weight: bold; border: 1px solid cyan; padding: 2px 8px; border-radius: 4px; }

        .label {
            color: #fff; text-shadow: 0 0 5px #000;
            font-family: sans-serif; padding: 4px 8px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 12px; border-radius: 4px;
            pointer-events: none; opacity: 0.8;
        }
    </style>
</head>
<body>

    <div id="instructions">
        <h1>BOSHLASH UCHUN EKRANGA BOSING</h1>
        <p>Sichqoncha bilan boshqaring, <span class="key">ESC</span> - Chiqish</p>
        <p><span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span> - Harakatlanish</p>
        <p><span class="key">SPACE</span> - Tepaga, <span class="key">CTRL</span> - Pastga</p>
        <p><span class="key">SHIFT</span> - TURBO TEZLIK (Sayyoraga yetib olish)</p>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        let camera, scene, renderer, labelRenderer, controls;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, moveUp = false, moveDown = false;
        let speedMultiplier = 1;
        const planets = [];
        let prevTime = performance.now();
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();
        const textureLoader = new THREE.TextureLoader();

        // SAYYORALAR (Real Teksturalar bilan)
        const planetData = [
            { name: "Merkuriy", texture: 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/moon_1024.jpg', size: 4, distance: 100, speed: 0.05 },
            { name: "Venera", color: 0xe3bb76, size: 6, distance: 150, speed: 0.03 }, // Venera teksturasi muammoli bo'lsa rang qoladi
            { name: "Yer", texture: 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg', size: 7, distance: 220, speed: 0.02 },
            { name: "Mars", texture: 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/mars_1k.jpg', size: 5, distance: 300, speed: 0.015 },
            { name: "Yupiter", color: 0xd8ca9d, size: 18, distance: 500, speed: 0.008 },
            { name: "Saturn", color: 0xead6b8, size: 15, distance: 700, speed: 0.006, ring: true },
            { name: "Uran", color: 0xd1e7e7, size: 10, distance: 900, speed: 0.004 },
            { name: "Neptun", color: 0x5b5ddf, size: 10, distance: 1100, speed: 0.003 }
        ];

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            // Qop-qora koinot emas, ozgina tuman qo'shamiz chuqurlik uchun
            scene.fog = new THREE.FogExp2(0x000000, 0.0002);
            
            addRealisticStars();

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100000);
            camera.position.set(0, 50, 400); // Quyoshdan sal uzoqroqda boshlaymiz

            // YORUG'LIK (Quyosh)
            const sunLight = new THREE.PointLight(0xffffff, 2.5, 5000, 0);
            scene.add(sunLight);
            scene.add(new THREE.AmbientLight(0x111111)); // Juda xira fon yorug'ligi

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            labelRenderer = new CSS2DRenderer();
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.domElement.style.position = 'absolute';
            labelRenderer.domElement.style.top = '0px';
            document.body.appendChild(labelRenderer.domElement);

            // CONTROLS
            controls = new PointerLockControls(camera, document.body);
            const instructions = document.getElementById('instructions');

            instructions.addEventListener('click', () => { controls.lock(); });
            controls.addEventListener('lock', () => { instructions.style.display = 'none'; });
            controls.addEventListener('unlock', () => { instructions.style.display = 'flex'; });

            document.addEventListener('keydown', (e) => onKey(e, true));
            document.addEventListener('keyup', (e) => onKey(e, false));
            window.addEventListener('resize', onWindowResize);

            createSun();
            planetData.forEach(createPlanet);
        }

        function addRealisticStars() {
            const starGeo = new THREE.BufferGeometry();
            const count = 15000;
            const positions = new Float32Array(count * 3);
            for(let i=0; i<count*3; i++) {
                positions[i] = (Math.random() - 0.5) * 10000; // Katta masofa
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 0.8, transparent: true, opacity: 0.8});
            const stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);
        }

        function createSun() {
            // Quyosh teksturasi (Lava effektiga o'xshash)
            const sunGeo = new THREE.SphereGeometry(60, 64, 64);
            const texture = textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/lava/lavatile.jpg');
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;
            
            const sunMat = new THREE.MeshBasicMaterial({ 
                map: texture,
                color: 0xffff00
            });
            const sun = new THREE.Mesh(sunGeo, sunMat);
            
            // Quyosh nuri (Glow)
            const glowGeo = new THREE.SphereGeometry(65, 32, 32);
            const glowMat = new THREE.MeshBasicMaterial({ color: 0xffaa00, transparent: true, opacity: 0.4, side: THREE.BackSide });
            sun.add(new THREE.Mesh(glowGeo, glowMat));

            scene.add(sun);
        }

        function createPlanet(data) {
            const geometry = new THREE.SphereGeometry(data.size, 64, 64);
            let material;

            if (data.texture) {
                // Agar tekstura bo'lsa, yuklaymiz
                const tex = textureLoader.load(data.texture);
                material = new THREE.MeshStandardMaterial({ map: tex, roughness: 0.8 });
            } else {
                // Bo'lmasa rang ishlatamiz
                material = new THREE.MeshStandardMaterial({ color: data.color, roughness: 0.7 });
            }

            const planet = new THREE.Mesh(geometry, material);
            
            // Random boshlang'ich joylashuv (hamma bir qatorda turmasligi uchun)
            const startAngle = Math.random() * Math.PI * 2;

            const planetObj = {
                mesh: planet,
                distance: data.distance,
                speed: data.speed * 0.5, // Biroz sekinlashtiramiz realizm uchun
                angle: startAngle
            };

            // Label
            const div = document.createElement('div');
            div.className = 'label';
            div.textContent = data.name;
            const label = new CSS2DObject(div);
            label.position.set(0, data.size + 5, 0);
            planet.add(label);

            // Saturn halqasi
            if (data.ring) {
                const ringGeo = new THREE.RingGeometry(data.size + 5, data.size + 15, 64);
                const ringMat = new THREE.MeshBasicMaterial({ color: 0xcfb593, side: THREE.DoubleSide, transparent: true, opacity: 0.6 });
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.rotation.x = Math.PI / 2 + 0.3; // Biroz qiyshiq
                planet.add(ring);
            }

            scene.add(planet);
            planets.push(planetObj);
        }

        function onKey(event, isDown) {
            switch (event.code) {
                case 'KeyW': moveForward = isDown; break;
                case 'KeyA': moveLeft = isDown; break;
                case 'KeyS': moveBackward = isDown; break;
                case 'KeyD': moveRight = isDown; break;
                case 'Space': moveUp = isDown; break;
                case 'ControlLeft': moveDown = isDown; break;
                case 'ShiftLeft': speedMultiplier = isDown ? 15 : 1; break; // Shift bilan 15x tezlik!
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            const time = performance.now();
            const delta = (time - prevTime) / 1000;

            // Sayyoralar harakati
            planets.forEach(p => {
                p.angle += p.speed * delta;
                p.mesh.position.x = Math.cos(p.angle) * p.distance;
                p.mesh.position.z = Math.sin(p.angle) * p.distance;
                p.mesh.rotation.y += 0.5 * delta; // O'z o'qi atrofida
            });

            // Uchish fizikasi
            if (controls.isLocked) {
                const friction = 5.0 * delta;
                velocity.x -= velocity.x * friction;
                velocity.z -= velocity.z * friction;
                velocity.y -= velocity.y * friction;

                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.y = Number(moveDown) - Number(moveUp);
                direction.normalize();

                const baseSpeed = 150.0; // Bazaviy tezlik oshirildi
                const actualSpeed = baseSpeed * speedMultiplier;

                if (moveForward || moveBackward) velocity.z -= direction.z * actualSpeed * delta;
                if (moveLeft || moveRight) velocity.x -= direction.x * actualSpeed * delta;
                if (moveUp || moveDown) velocity.y -= direction.y * actualSpeed * delta;

                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);
                camera.position.y -= velocity.y * delta;
            }

            prevTime = time;
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }
    </script>
</body>
</html>
