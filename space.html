<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>JARVIS - BRIGHT SPACE</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* BOSHQARUV PANELÄ° (HUD) */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; user-select: none;
        }
        #info-box {
            position: absolute; top: 20px; right: 20px;
            text-align: right; color: #00ffea; text-shadow: 0 0 5px #00ffea;
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px;
        }
        #center-target {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 20px; height: 20px; border: 1px solid rgba(0, 255, 234, 0.5); border-radius: 50%;
            box-shadow: 0 0 10px cyan;
        }
        #planet-label {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            text-align: center; color: white; opacity: 0; transition: opacity 0.5s;
        }
        #planet-name { font-size: 40px; font-weight: bold; letter-spacing: 5px; text-shadow: 0 0 20px white; }
        #planet-dist { font-size: 18px; color: cyan; }

        /* KIRISH EKRANI */
        #menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.85); color: white; z-index: 1000; cursor: pointer;
        }
        .key { color: #000; background: #00ffea; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        
        #loading { color: yellow; font-size: 20px; margin-top: 20px; display: none; }
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="color: #00ffea; text-shadow: 0 0 30px #00ffea; font-size: 50px;">JARVIS SPACE</h1>
        <p style="font-size: 20px;">SIMULYATSIYANI BOSHLASH UCHUN EKRANGA BOSING</p>
        <div id="loading">Teksturalar yuklanmoqda... (Biroz kuting)</div>
        <br>
        <p><span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span> - Harakat</p>
        <p><span class="key">SPACE</span> - Tepaga | <span class="key">CTRL</span> - Pastga</p>
        <p><span class="key">SHIFT</span> - GIPER-TEZLIK (20x)</p>
    </div>

    <div id="hud">
        <div id="center-target"></div>
        <div id="info-box">
            <div id="time-display">VAQT: Real</div>
            <div id="speed-display">Tezlik: 0 km/s</div>
        </div>
        <div id="planet-label">
            <div id="planet-name">YER</div>
            <div id="planet-dist">Masofa: 0 km</div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        let camera, scene, renderer, controls;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, moveUp = false, moveDown = false;
        let speedMultiplier = 1;
        let timeScale = 1;
        
        const planets = [];
        const textureLoader = new THREE.TextureLoader();
        let labelDiv = document.getElementById('planet-label');

        init();
        animate();

        function init() {
            // 1. SAHNA
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505); // Juda to'q kulrang fon (qop-qora emas)
            scene.fog = new THREE.FogExp2(0x000000, 0.00002);

            // 2. KAMERA
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000000);
            camera.position.set(0, 50, 400);

            // 3. RENDERER
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            // Yoritishni to'g'irlash (Output Encoding)
            renderer.outputColorSpace = THREE.SRGBColorSpace; 
            document.body.appendChild(renderer.domElement);

            // 4. NAZORAT
            controls = new PointerLockControls(camera, document.body);
            const menu = document.getElementById('menu');

            menu.addEventListener('click', () => { controls.lock(); });
            controls.addEventListener('lock', () => { menu.style.display = 'none'; });
            controls.addEventListener('unlock', () => { menu.style.display = 'flex'; });

            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            document.addEventListener('wheel', onScroll);

            // 5. YORUG'LIK (MUHIM QISM!) ðŸ’¡ðŸ’¡ðŸ’¡
            
            // A) Quyosh nuri (Markazdan)
            const sunLight = new THREE.PointLight(0xffffff, 3, 0); // 3 barobar kuchli, 0 = cheksiz masofa
            sunLight.position.set(0, 0, 0);
            scene.add(sunLight);
            
            // B) Umumiy yorug'lik (Ambient Light) - Bu soyalarni qora bo'lishini oldini oladi
            const ambientLight = new THREE.AmbientLight(0x404040, 2); // To'q kulrang, kuchliroq
            scene.add(ambientLight);

            // 6. OBEKTLAR
            createStars();
            createSun();
            createSolarSystem();

            window.addEventListener('resize', onWindowResize);
        }

        function createStars() {
            const starGeo = new THREE.BufferGeometry();
            const count = 10000;
            const positions = new Float32Array(count * 3);
            for(let i=0; i<count*3; i++) {
                positions[i] = (Math.random() - 0.5) * 10000;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 0.8});
            const stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);
        }

        function createSun() {
            // Quyosh o'zi nur taratadi (MeshBasicMaterial) - Yorug'liksiz ham ko'rinadi
            const geometry = new THREE.SphereGeometry(60, 64, 64);
            const material = new THREE.MeshBasicMaterial({ 
                color: 0xffaa00,
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/lava/lavatile.jpg')
            });
            const sun = new THREE.Mesh(geometry, material);
            
            // Glow (Nur effekti)
            const spriteMat = new THREE.SpriteMaterial({ 
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/sprites/glow.png'), 
                color: 0xffaa00, 
                transparent: true, 
                blending: THREE.AdditiveBlending 
            });
            const sprite = new THREE.Sprite(spriteMat);
            sprite.scale.set(350, 350, 1);
            sun.add(sprite);

            scene.add(sun);
        }

        function createSolarSystem() {
            // YER
            createEarth();

            // BOSHQA SAYYORALAR
            const data = [
                { name: "Merkuriy", size: 4, dist: 100, speed: 0.04, color: 0xaaaaaa, tex: 'moon_1024.jpg' },
                { name: "Venera", size: 9, dist: 160, speed: 0.03, color: 0xe6b800, tex: 'venus_atmosphere_2k.jpg' }, // Venera (agar bo'lmasa sariq)
                { name: "Mars", size: 5, dist: 300, speed: 0.018, color: 0xff3300, tex: 'mars_1k.jpg' },
                { name: "Yupiter", size: 30, dist: 500, speed: 0.008, color: 0xd9b38c, tex: 'jupiter_2k.jpg' },
                { name: "Saturn", size: 25, dist: 750, speed: 0.006, color: 0xf4d19f, tex: 'saturn_2k.jpg', ring: true },
                { name: "Uran", size: 12, dist: 950, speed: 0.004, color: 0x66ccff, tex: 'uranus_2k.jpg' }, // Agar bo'lmasa ko'k
                { name: "Neptun", size: 12, dist: 1100, speed: 0.003, color: 0x3333ff, tex: 'neptune_2k.jpg' } // Agar bo'lmasa to'q ko'k
            ];

            data.forEach(p => {
                const geo = new THREE.SphereGeometry(p.size, 64, 64);
                
                // Tekstura yuklash
                const texUrl = `https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/${p.tex}`;
                const tex = textureLoader.load(texUrl);
                
                // MATERIAL: Standard material yorug'likka reaksiya beradi
                const mat = new THREE.MeshStandardMaterial({ 
                    map: tex,
                    color: 0xffffff, // Oq rang (tekstura o'z rangini ko'rsatishi uchun)
                    roughness: 0.5,
                    metalness: 0.1
                });

                const mesh = new THREE.Mesh(geo, mat);

                // Halqasi bormi?
                if(p.ring) {
                    const ringGeo = new THREE.RingGeometry(p.size + 5, p.size + 15, 64);
                    const ringMat = new THREE.MeshBasicMaterial({ 
                        color: 0xcfb593, 
                        side: THREE.DoubleSide, 
                        transparent: true, 
                        opacity: 0.6 
                    });
                    const ring = new THREE.Mesh(ringGeo, ringMat);
                    ring.rotation.x = Math.PI / 2;
                    mesh.add(ring);
                }

                planets.push({ mesh: mesh, dist: p.dist, speed: p.speed, angle: Math.random() * 10, name: p.name });
                scene.add(mesh);
            });
        }

        function createEarth() {
            // YER UCHUN MAXSUS
            const earthGeo = new THREE.SphereGeometry(10, 64, 64);
            const earthMat = new THREE.MeshPhongMaterial({
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg'),
                specularMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg'),
                specular: new THREE.Color(0x333333),
                shininess: 5
            });
            const earth = new THREE.Mesh(earthGeo, earthMat);

            // Bulutlar
            const cloudGeo = new THREE.SphereGeometry(10.2, 64, 64);
            const cloudMat = new THREE.MeshPhongMaterial({
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_clouds_1024.png'),
                side: THREE.DoubleSide,
                opacity: 0.8,
                transparent: true,
                depthWrite: false,
            });
            const clouds = new THREE.Mesh(cloudGeo, cloudMat);
            earth.add(clouds);

            // Oy
            const moonGeo = new THREE.SphereGeometry(2.7, 32, 32);
            const moonMat = new THREE.MeshStandardMaterial({
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/moon_1024.jpg')
            });
            const moon = new THREE.Mesh(moonGeo, moonMat);
            moon.position.set(25, 0, 0);
            earth.add(moon);

            planets.push({ mesh: earth, dist: 200, speed: 0.02, angle: 0, name: "YER", rotateSelf: true, clouds: clouds });
            scene.add(earth);
        }

        function onKeyDown(event) {
            switch (event.code) {
                case 'KeyW': moveForward = true; break;
                case 'KeyA': moveLeft = true; break;
                case 'KeyS': moveBackward = true; break;
                case 'KeyD': moveRight = true; break;
                case 'Space': moveUp = true; break;
                case 'ControlLeft': moveDown = true; break;
                case 'ShiftLeft': speedMultiplier = 20; break;
            }
        }

        function onKeyUp(event) {
            switch (event.code) {
                case 'KeyW': moveForward = false; break;
                case 'KeyA': moveLeft = false; break;
                case 'KeyS': moveBackward = false; break;
                case 'KeyD': moveRight = false; break;
                case 'Space': moveUp = false; break;
                case 'ControlLeft': moveDown = false; break;
                case 'ShiftLeft': speedMultiplier = 1; break;
            }
        }

        function onScroll(event) {
            if(event.deltaY < 0) timeScale *= 1.2;
            else timeScale /= 1.2;
            document.getElementById('time-display').innerText = `VAQT: ${timeScale.toFixed(1)}x`;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            planets.forEach(p => {
                p.angle += p.speed * 0.1 * timeScale;
                p.mesh.position.x = Math.cos(p.angle) * p.dist;
                p.mesh.position.z = Math.sin(p.angle) * p.dist;
                
                p.mesh.rotation.y += 0.005 * timeScale;
                if(p.clouds) p.clouds.rotation.y += 0.007 * timeScale;
            });

            if (controls.isLocked) {
                const delta = 0.5 * speedMultiplier;
                if (moveForward) controls.moveForward(delta);
                if (moveBackward) controls.moveForward(-delta);
                if (moveRight) controls.moveRight(delta);
                if (moveLeft) controls.moveRight(-delta);
                if (moveUp) camera.position.y += delta;
                if (moveDown) camera.position.y -= delta;
            }

            // Masofa o'lchash
            let nearest = null;
            let minDist = Infinity;
            planets.forEach(p => {
                const d = camera.position.distanceTo(p.mesh.position);
                if(d < minDist) { minDist = d; nearest = p; }
            });

            if(nearest && minDist < 200) {
                labelDiv.style.opacity = 1;
                document.getElementById('planet-name').innerText = nearest.name;
                document.getElementById('planet-dist').innerText = `Masofa: ${Math.floor(minDist * 1000)} km`;
                document.getElementById('center-target').style.borderColor = "red";
            } else {
                labelDiv.style.opacity = 0;
                document.getElementById('center-target').style.borderColor = "cyan";
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
